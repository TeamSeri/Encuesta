@model Encuesta.Models.EncuestaP

@{
    ViewBag.Title = "Encuesta";
}
    <div class="container" style="margin-top:3em !important;">
        @{
            if (Model.sEstado == "success")
            {
                <div class="row text-left">
                    <div class="col-md-3">
                        <h4>Empresa: <b><span id="nombre_empresa"></span></b> </h4>
                    </div>
                    <div class="col-md-3">
                        <h4>Empleados asignados: <b>@Model.iEmpleados</b> </h4>
                    </div>
                    <div class="col-md-3">
                        <h4>Aplicaciones requeridas: <b>@Model.iAplicacionesReq</b> </h4>
                    </div>
                    <div class="col-md-3">
                        <h4>Aplicaciones restantes: <b><span id="app_restantes"></span></b> </h4>
                    </div>
                </div>
                <br />
                <div class="row">
                    <div class="col-lg-offset-2 col-md-8">
                        <hr />
                        <div class="text-center">
                            <h3><b id="titulo1"></b></h3>
                        </div>
                        <hr />
                        <form method="post" id="formdata">
                            <input type="hidden" disabled name="empresa" value="@Model.iIdEmpresa" />
                            <div id="form_preguntas"></div>
                            <div class="form-group" id="formbutton">
                                <div class="col-md-12 text-center">
                                    <button class="btn btn-primary" type="submit">
                                        Enviar
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            }
            else
            {
                <h1 class="text-center text-danger" style="margin-top:3em;">
                    Opss...
                </h1>
                <h2 class="text-center text-dagner" style="margin-bottom:3em;">
                    Ocurrio un error interno, seras redirigido a la pantalla de inicio en <b id="seg"></b> segundos...
                </h2>
            }
        }
    </div>
@{ 
    if (Model.sEstado == "success")
    {
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', () => {
            const empresa = @Model.iIdEmpresa;
            const empleados = @Model.iEmpleados;
            const nombreEmpresa = document.getElementById('nombre_empresa');
            const apprestantes = document.getElementById('app_restantes');
            $.ajax({
                type : 'POST',
                url: '/EncuestaP/DatosEmpresa',
                data: { empresa: empresa },
                error: function (err) {
                    console.log(err);
                },
                success: function (data) {
                    if (data.sMensaje != "error") {
                        nombreEmpresa.textContent = data.sNombre;
                        apprestantes.textContent = data.iAplicacionesRestantes;
                    } else {

                        console.log('Ocurrio un error');
                    }
                }
            });
        });
        </script>
        <script type="text/javascript" src="~/Scripts/Encuestas/dataTests.js"></script>
    } else
    {
        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', () => {
                let cont = 10;
                const seg = document.getElementById('seg');
                window.setInterval(() => {
                    if (cont == -1) {
                        seg.textContent = 0;
                        location.href = "../../";
                    } else {
                        seg.textContent = cont;
                        cont--;
                    }
                }, 1000);
            });
        </script>
    }
}

